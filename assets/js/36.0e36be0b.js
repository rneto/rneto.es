(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{458:function(a,e,s){"use strict";s.r(e);var n=s(6),t=Object(n.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"sobre-los-despliegues-con-angular-la-carga-diferida-de-modulos-y-las-ventajas-de-una-pwa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sobre-los-despliegues-con-angular-la-carga-diferida-de-modulos-y-las-ventajas-de-una-pwa"}},[a._v("#")]),a._v(" Sobre los despliegues con Angular, la carga diferida de módulos y las ventajas de una PWA")]),a._v(" "),s("social-share",{staticClass:"social-share--header"}),a._v(" "),s("p",[a._v("Cuando generamos una aplicación Angular para su despliegue con la configuración de producción predeterminada, automáticamente nos encontramos con una serie de ficheros de fragmentos de código ("),s("em",[a._v("chuncks")]),a._v(") nombrados específicamente para dicha generación y empaquetado y donde webpack se encarga de todo el trabajo de manera transparente para nosotros. Un posible ejemplo de los ficheros que nos encontraríamos en la carpeta "),s("em",[a._v("dist")]),a._v(" serían:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("dist/\n|- 339.5bafa95f5069e770796c.js\n|- 592.7d0bbcb1e2716fd8c89c.js\n|- index.html\n|- main.aacafeb9a86f33b33dbb.js\n|- polyfills.90cb5c4ede3ffbbf8eac.js\n|- runtime.90b29387259b20a3df3f.js\n|- styles.182e3c991344b37810ea.css\n")])])]),s("p",[a._v("Podemos observar que en el nombre de los ficheros "),s("em",[a._v("css")]),a._v(" y "),s("em",[a._v("js")]),a._v(" existe una cadena de caracteres alfanuméricos aleatorios, que en realidad es un código hash que se calcula en base al contenido de cada fichero. Es por ello que cuando realizamos cambios en nuestro código y volvemos a hacer una nueva generación y empaquetado de la aplicación, el código hash de cada fichero puede variar:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("dist/\n|- 339.681c5565b08b6b94c92c.js\n|- 592.6ad7450cd17f530a77ba.js\n|- index.html\n|- main.dcc0fdb08ffa222d9e74.js\n|- polyfills.90cb5c4ede3ffbbf8eac.js\n|- runtime.20caa6a1d9eb3da29ff6.js\n|- styles.55ff9c680cf12d9405cc.css\n")])])]),s("p",[a._v("Uno de los criterios que determina el número de ficheros en los que se empaquetará nuestra aplicación tiene relación con una de las "),s("RouterLink",{attrs:{to:"/blog/arquitectura-buenas-practicas-angular/"}},[a._v("buenas prácticas de Angular")]),a._v(" usada muy habitualmente para optimizar su rendimiento y que consiste en el uso de la "),s("RouterLink",{attrs:{to:"/blog/arquitectura-buenas-practicas-angular/#carga-diferida"}},[a._v("carga diferida")]),a._v(" de los "),s("RouterLink",{attrs:{to:"/blog/arquitectura-buenas-practicas-angular/#feature-modules"}},[a._v("módulos de funcionalidades")]),a._v(". Dicha práctica permite que una vez generada y empaquetada nuestra aplicación, nuestro código se fragmente en más ficheros, los cuales se descargarán dinámicamente del servidor según la aplicación vaya haciendo uso de cada módulo en cuestión.")],1),a._v(" "),s("p",[a._v("Dado este comportamiento del sistema de generación de Angular, podríamos preguntarnos:")]),a._v(" "),s("h2",{attrs:{id:"¿que-ocurre-cuando-desplegamos-una-nueva-version-de-una-aplicacion-angular-y-el-navegador-del-cliente-ha-cacheado-la-version-anterior"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#¿que-ocurre-cuando-desplegamos-una-nueva-version-de-una-aplicacion-angular-y-el-navegador-del-cliente-ha-cacheado-la-version-anterior"}},[a._v("#")]),a._v(" ¿Qué ocurre cuando desplegamos una nueva versión de una aplicación Angular y el navegador del cliente ha cacheado la versión anterior?")]),a._v(" "),s("p",[a._v("El fichero "),s("em",[a._v("index.html")]),a._v(" tiene las referencias a los ficheros principales de la aplicación (según mi ejemplo, "),s("em",[a._v("main.*.js")]),a._v(", "),s("em",[a._v("polyfills.*.js")]),a._v(", "),s("em",[a._v("runtime.*.js")]),a._v(" y "),s("em",[a._v("styles.*.css")]),a._v("), los cuales a su vez, cargan dinámicamente el resto de ficheros cuando sea necesario (según mi ejemplo "),s("em",[a._v("339.*.js")]),a._v(" y "),s("em",[a._v("592.*.js")]),a._v("). Esto implica que si no hemos seguido una estrategia adecuada en cuanto a la configuración del servidor donde hemos publicado nuestra aplicación, es muy probable que en algún momento la aplicación le falle al cliente, bien porque está accediendo a recursos cacheados que ya no son válidos (puede que estemos realizando operaciones que ya no están disponibles) o porque intenta acceder a recursos o ficheros de fragmentos de código que ya no existen (este sería el error típico de "),s("em",[a._v("ChunkLoadError: Loading chunk 339 failed.")]),a._v(", donde el 339 hace referencia a uno de los ficheros de fragmento de código de mi ejemplo).")]),a._v(" "),s("p",[a._v("Así pues, una sencilla medida a tomar para evitar este problema, consiste en deshabilitar la caché del fichero "),s("em",[a._v("index.html")]),a._v(" de nuestra aplicación agregándole el encabezado HTTP "),s("strong",[s("em",[a._v("Cache-Control")])]),a._v(" con el valor "),s("strong",[s("em",[a._v("no-store, max-age=0")])]),a._v(".")]),a._v(" "),s("blockquote",[s("p",[a._v("¿Por qué "),s("em",[a._v("no-store")]),a._v(" en lugar de "),s("em",[a._v("no-cache")]),a._v("? Con "),s("em",[a._v("no-store")]),a._v(", el recurso no se almacena en ningún lugar. Con "),s("em",[a._v("no-cache")]),a._v(", el recurso puede almacenarse, pero el almacén debe validarse con el servidor antes de usarlo.")])]),a._v(" "),s("blockquote",[s("p",[a._v("¿Por qué "),s("em",[a._v("max-age=0")]),a._v("? Fuerza a que se borren las respuestas de caché válidas preexistentes ("),s("em",[a._v("no-store")]),a._v(" no lo hace).")])]),a._v(" "),s("blockquote",[s("p",[a._v("Si estás usando Internet Information Services, te recomiendo que le eches un vistazo a mi artículo sobre "),s("RouterLink",{attrs:{to:"/blog/desplegar-angular-internet-information-services/"}},[a._v("Desplegar una aplicación Angular en Internet Information Services")]),a._v(" donde encontrarás cómo adaptar tu fichero "),s("em",[a._v("web.config")]),a._v(" para añadir la cabecera personalizada "),s("em",[a._v("Cache-Control")]),a._v(" al fichero "),s("em",[a._v("index.html")]),a._v(".")],1)]),a._v(" "),s("p",[a._v("Con esta técnica, tendríamos una solución sencilla sobre cómo evitar problemas con la caché del navegador del cliente cuando despleguemos nuevas versiones de nuestra aplicación Angular, sin embargo, ¿cómo evitamos estos errores si durante el despliegue de una nueva versión los usuarios están navegando por la aplicación?")]),a._v(" "),s("h2",{attrs:{id:"ventajas-de-convertir-una-aplicacion-angular-en-pwa-progressive-web-app-aplicacion-web-progresiva"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ventajas-de-convertir-una-aplicacion-angular-en-pwa-progressive-web-app-aplicacion-web-progresiva"}},[a._v("#")]),a._v(" Ventajas de convertir una aplicación Angular en PWA (Progressive Web App, Aplicación Web Progresiva)")]),a._v(" "),s("blockquote",[s("p",[a._v("¿Qué es una PWA? Básicamente es una aplicación web a la que hemos dotado de nuevas capacidades para hacerla más potente mediante las API de los navegadores modernos, incrementado su rendimiento y fiabilidad mediante una mejor experiencia de usuario independientemente de la calidad de la red y por último, transformado la interacción de los usuarios haciéndola instalable.")])]),a._v(" "),s("p",[a._v("Una de las ventajas de convertir una aplicación Angular en PWA consiste en que convertimos nuestra aplicación web en descargable e instalable, del mismo modo que se haría con una aplicación nativa, con el añadido de que la misma aplicación será compatible con cualquier sistema operativo que incluya alguno de los navegadores modernos.")]),a._v(" "),s("p",[a._v("El proceso de descarga e instalación ocurre en segundo plano, sin por ello alterar la experiencia del usuario y donde además el sistema de actualización se basa en un versionado incremental, es decir, con un simple cambio en alguno de nuestros ficheros, se producirá la reinstalación exclusiva de los recursos que se vean afectados, en lugar de instalarse toda la aplicación nuevamente.")]),a._v(" "),s("p",[a._v("Además, el usuario siempre tendrá activa una versión completa operativa e inclusive podría llegar a tener diferentes pestañas del navegador con diferentes versiones, con la ventaja de que le podríamos preguntar en cada caso si desea una actualización de la versión de cada instancia de la aplicación.")]),a._v(" "),s("p",[a._v("También obtenemos ventajas en cuanto al tiempo de respuesta en la descarga de los recursos de la aplicación ya que el Service Worker funciona como una capa intermedia de caché en el navegador, aligerándose por lo tanto los tiempos de carga de los recursos requeridos por la navegación del usuario.")]),a._v(" "),s("h2",{attrs:{id:"convertir-una-aplicacion-angular-en-pwa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#convertir-una-aplicacion-angular-en-pwa"}},[a._v("#")]),a._v(" Convertir una aplicación Angular en PWA")]),a._v(" "),s("p",[a._v("Para convertir una aplicación existente en PWA basta con ejecutar el siguiente comando en la carpeta de nuestra aplicación:")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("ng "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" @angular/pwa --project *project-name*\n")])])]),s("p",[s("em",[s("em",[a._v("project-name")]),a._v(" se refiere al nombre de nuestro proyecto, tal cual figura en el fichero angular.json.")])]),a._v(" "),s("p",[a._v("Con esta simple acción, se habrán llevado a cabo las siguientes operaciones:")]),a._v(" "),s("ul",[s("li",[a._v("Agregado del "),s("code",[a._v("@angular/service-worker")]),a._v(" al proyecto.")]),a._v(" "),s("li",[a._v("Habilitado de la compatibilidad con la compilación del Service Worker en Angular CLI.")]),a._v(" "),s("li",[a._v("Importación y registro del Service Worker en el módulo "),s("em",[a._v("AppModule")]),a._v(".")]),a._v(" "),s("li",[a._v("Actualización del fichero "),s("em",[a._v("index.html")]),a._v(" para incluir un enlace al nuevo fichero "),s("em",[a._v("manifest.webmanifest")]),a._v(" y para agrega una etiqueta "),s("em",[a._v("meta")]),a._v(" para el color del tema.")]),a._v(" "),s("li",[a._v("Añadido de los iconos predeterminados (que podremos sustituir) para la instalación de la PWA.")]),a._v(" "),s("li",[a._v("Creación del fichero de configuración del Service Worker "),s("em",[a._v("ngsw-config.json")]),a._v(", donde se especifica el comportamiento de la caché y otros parámetros.")])]),a._v(" "),s("p",[a._v("Dado que "),s("em",[a._v("ng serve")]),a._v(" no ofrece soporte para probar nuestro nuevo Service Worker, podemos hacer uso del paquete "),s("em",[s("RouterLink",{attrs:{to:"/blog/servir-archivos-html-estaticos-localmente-nodejs-http-server/"}},[a._v("http-server")])],1),a._v(" para nuestras pruebas.")]),a._v(" "),s("p",[a._v("En primer lugar lo instalamos globalmente:")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -g http-server\n")])])]),s("p",[a._v("Y a continuación servimos nuestra aplicación, la cual hemos generado previamente con "),s("em",[a._v("ng build")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("http-server -p "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(" -c-1 dist\n")])])]),s("p",[a._v("Para conocer más sobre Service Workers y Angular PWA, te recomiendo que le eches un vistazo a "),s("a",{attrs:{href:"https://angular.io/guide/service-worker-intro",target:"_blank",rel:"noopener noreferrer"}},[a._v("Angular service worker introduction"),s("OutboundLink")],1),a._v(" y los recursos relacionados.")]),a._v(" "),s("h2",{attrs:{id:"notificar-al-usuario-de-la-existencia-de-una-nueva-version-de-la-aplicacion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#notificar-al-usuario-de-la-existencia-de-una-nueva-version-de-la-aplicacion"}},[a._v("#")]),a._v(" Notificar al usuario de la existencia de una nueva versión de la aplicación")]),a._v(" "),s("p",[a._v("Una vez hayamos convertido nuestra aplicación a PWA, ya tenemos la capacidad de poder notificar al usuario cuando exista una nueva versión de la aplicación y por lo tanto, asegurarnos de que use la versión correcta. Para ello crearemos un servicio que comprobará la versión de la aplicación en tres escenarios distintos:")]),a._v(" "),s("ol",[s("li",[a._v("Durante la inicialización de la aplicación, tras una navegación desde fuera de nuestra aplicación o cuando se haga una actualización manual.")]),a._v(" "),s("li",[a._v("Tras una comprobación programada que hemos configurado para realizarse por ejemplo cada 10 minutos.")]),a._v(" "),s("li",[a._v("Cuando se produzcan inconsistencias en la caché de la aplicación que impidan cargarla correctamente.")])]),a._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" SwUpdate "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@angular/service-worker'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" ApplicationRef"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Injectable "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@angular/core'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" concat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" interval "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'rxjs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" first "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'rxjs/operators'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n@"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Injectable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  providedIn"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'root'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("VersionUpdateService")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" ApplicationRef"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" updates"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" SwUpdate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("updates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("isEnabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 1. Inicialización")]),a._v("\n      updates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("available"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("confirm")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Hay una nueva versión de la aplicación. ¿Deseas instalarla ahora?'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n          updates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("activateUpdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("reload")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 2. Comprobación")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" appIsStable$ "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("isStable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pipe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("first")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("isStable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" isStable "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("===")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" checkInterval$ "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" everyIntervalOnceAppIsStable$ "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("concat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        appIsStable$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        checkInterval$\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      everyIntervalOnceAppIsStable$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" updates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("checkForUpdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 3. Inconsistencias")]),a._v("\n      updates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("unrecoverable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Se ha producido un error y no podemos cargar la aplicación. Por favor, recarga la página para solucionarlo.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Y para terminar, ya sólo tendríamos que agregar el servicio al constructor de nuestro componente de entrada "),s("em",[a._v("app.component.ts")]),a._v(" para que se ponga en marcha el servicio de comprobación de versiones de la aplicación.")]),a._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ...")]),a._v("\n@"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Component")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  selector"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'app-root'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  templateUrl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'./app.component.html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AppComponent")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OnInit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" versionUpdateService"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" VersionUpdateService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("hr"),a._v(" "),s("social-share",{staticClass:"social-share--header"})],1)}),[],!1,null,null,null);e.default=t.exports}}]);