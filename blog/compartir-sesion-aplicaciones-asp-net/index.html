<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Compartir la sesión entre aplicaciones web ASP.NET | Rafael Neto</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#8a278c">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-S8PRT356B6"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-S8PRT356B6', { 'anonymize_ip': true });</script>
    <link rel="alternate" type="application/rss+xml" href="https://rneto.es/rss.xml" title="Rafael Neto RSS Feed">
    <meta name="description" content="

Estos días he estado investigando sobre cómo compartir la sesión de un usuario entre varias aplicaciones web ASP.NET. La idea era poner en marcha rápidamente una nueva aplicación web aprovechándome del ...">
    <meta property="article:published_time" content="2020-07-06T00:00:00.000Z">
    <meta property="og:site_name" content="Rafael Neto">
    <meta property="og:title" content="Compartir la sesión entre aplicaciones web ASP.NET">
    <meta property="og:description" content="

Estos días he estado investigando sobre cómo compartir la sesión de un usuario entre varias aplicaciones web ASP.NET. La idea era poner en marcha rápidamente una nueva aplicación web aprovechándome del ...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/blog/compartir-sesion-aplicaciones-asp-net/">
    <meta name="twitter:title" content="Compartir la sesión entre aplicaciones web ASP.NET">
    <meta name="twitter:description" content="

Estos días he estado investigando sobre cómo compartir la sesión de un usuario entre varias aplicaciones web ASP.NET. La idea era poner en marcha rápidamente una nueva aplicación web aprovechándome del ...">
    <meta name="twitter:url" content="/blog/compartir-sesion-aplicaciones-asp-net/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="ASPNET, SQLServer">
    <meta property="article:tag" content="ASPNET">
    <meta name="theme-color" content="#8a278c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/images/icons/icon-144x144">
    <meta name="msapplication-TileColor" content="#000000">
    <link href="https://rafaelneto.dev/blog/compartir-sesion-aplicaciones-asp-net/" rel="canonical" />
    <link rel="preload" href="/assets/css/0.styles.a8cfd089.css" as="style"><link rel="preload" href="/assets/js/app.141143c0.js" as="script"><link rel="preload" href="/assets/js/4.4029fd2e.js" as="script"><link rel="preload" href="/assets/js/1.86b5f33c.js" as="script"><link rel="preload" href="/assets/js/28.1ff7415b.js" as="script"><link rel="prefetch" href="/assets/js/11.86efaf11.js"><link rel="prefetch" href="/assets/js/12.819aa9c2.js"><link rel="prefetch" href="/assets/js/13.f9ca707a.js"><link rel="prefetch" href="/assets/js/14.0bfafa79.js"><link rel="prefetch" href="/assets/js/15.a72d5766.js"><link rel="prefetch" href="/assets/js/16.84cc3fff.js"><link rel="prefetch" href="/assets/js/17.1c4d7bb2.js"><link rel="prefetch" href="/assets/js/18.07d1b92f.js"><link rel="prefetch" href="/assets/js/19.8e1e7634.js"><link rel="prefetch" href="/assets/js/2.672f14be.js"><link rel="prefetch" href="/assets/js/20.9336b100.js"><link rel="prefetch" href="/assets/js/21.150454e1.js"><link rel="prefetch" href="/assets/js/22.eb96b462.js"><link rel="prefetch" href="/assets/js/23.f44c0f2b.js"><link rel="prefetch" href="/assets/js/24.ea88404b.js"><link rel="prefetch" href="/assets/js/25.6f767423.js"><link rel="prefetch" href="/assets/js/26.a3bfdd85.js"><link rel="prefetch" href="/assets/js/27.cb92dccf.js"><link rel="prefetch" href="/assets/js/29.352abd36.js"><link rel="prefetch" href="/assets/js/3.e8a2d185.js"><link rel="prefetch" href="/assets/js/30.2a94513b.js"><link rel="prefetch" href="/assets/js/31.e0d1dfcc.js"><link rel="prefetch" href="/assets/js/32.153bb60a.js"><link rel="prefetch" href="/assets/js/33.5ababa24.js"><link rel="prefetch" href="/assets/js/34.de91b085.js"><link rel="prefetch" href="/assets/js/35.e68dd8b2.js"><link rel="prefetch" href="/assets/js/36.0e36be0b.js"><link rel="prefetch" href="/assets/js/37.eb19db32.js"><link rel="prefetch" href="/assets/js/38.48b82aee.js"><link rel="prefetch" href="/assets/js/39.22e6ac88.js"><link rel="prefetch" href="/assets/js/40.220156b6.js"><link rel="prefetch" href="/assets/js/41.194c7ecd.js"><link rel="prefetch" href="/assets/js/42.2c232f6e.js"><link rel="prefetch" href="/assets/js/43.90ab30a8.js"><link rel="prefetch" href="/assets/js/44.e1a58041.js"><link rel="prefetch" href="/assets/js/45.cf0695fb.js"><link rel="prefetch" href="/assets/js/46.941a4e15.js"><link rel="prefetch" href="/assets/js/47.32f71387.js"><link rel="prefetch" href="/assets/js/48.feab1cab.js"><link rel="prefetch" href="/assets/js/49.36e78334.js"><link rel="prefetch" href="/assets/js/5.f5685626.js"><link rel="prefetch" href="/assets/js/50.b21cbbd9.js"><link rel="prefetch" href="/assets/js/51.ab0894a0.js"><link rel="prefetch" href="/assets/js/6.d2c2e4a9.js"><link rel="prefetch" href="/assets/js/7.1842ce6d.js"><link rel="prefetch" href="/assets/js/8.4077d3ac.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.f5f03a8d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a8cfd089.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Rafael Neto </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Rafael Neto </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-7-6">
      06/07/2020
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/ASPNET" data-v-42ccfcd5><span data-v-42ccfcd5>ASPNET</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/SQLServer" data-v-42ccfcd5><span data-v-42ccfcd5>SQLServer</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="compartir-la-sesion-entre-aplicaciones-web-asp-net"><a href="#compartir-la-sesion-entre-aplicaciones-web-asp-net" class="header-anchor">#</a> Compartir la sesión entre aplicaciones web ASP.NET</h1> <!----> <p>Estos días he estado investigando sobre cómo compartir la sesión de un usuario entre varias aplicaciones web ASP.NET. La idea era poner en marcha rápidamente una nueva aplicación web aprovechándome del sistema de autenticación y de la gestión del estado de la sesión de otra aplicación web antigua, hasta que pueda implementar una solución SSO entre ambas aplicaciones y crear un API específico para la nueva aplicación web que me permita dejar de usar el estado de la sesión del usuario.</p> <p>Para ello es necesario seguir los siguientes pasos:</p> <h2 id="creacion-de-cookies-a-nivel-de-dominio"><a href="#creacion-de-cookies-a-nivel-de-dominio" class="header-anchor">#</a> Creación de cookies a nivel de dominio</h2> <p>Debemos asegurarnos de que las cookies son creadas al nivel de dominio. Para ello debemos indicar en el fichero <em>web.config</em> de ambas aplicaciones la misma configuración:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>httpCookies</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.midominio.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="configuracion-de-claves-de-cifrado"><a href="#configuracion-de-claves-de-cifrado" class="header-anchor">#</a> Configuración de claves de cifrado</h2> <p>Es necesario establecer en ambas aplicaciones la misma configuración de claves mediante el nodo <em>machineKey</em> en el fichero <em>web.config</em>:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>machineKey</span> <span class="token attr-name">validationKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[MISMA-KEY]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">decryptionKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[MISMA-DECRIPTION-KEY]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">validation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AES<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="configuracion-de-la-autenticacion-y-del-estado-de-la-sesion"><a href="#configuracion-de-la-autenticacion-y-del-estado-de-la-sesion" class="header-anchor">#</a> Configuración de la autenticación y del estado de la sesión</h2> <p>También debemos compartir entre ambas aplicaciones la configuración relativa al sistema de autenticación y de gestión del estado de la sesión mediante sus ficheros <em>web.config</em>.</p> <p>En mi caso estoy usando SQLServer para almacenar el estado de la sesión, pero estos pasos también valdrían para los demás modos de gestión del estado de la sesión:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>authentication</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Forms<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>forms</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AUTH-FORM-COOKIE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">loginUrl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/Default.aspx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>All<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1440<span class="token punctuation">&quot;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slidingExpiration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cookieless</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UseCookies<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>authentication</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>authorization</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>deny</span> <span class="token attr-name">users</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allow</span> <span class="token attr-name">users</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>authorization</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sessionState</span> <span class="token attr-name">cookieName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SESSION-STATE-COOKIE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SQLServer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">allowCustomSqlDatabase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlConnectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[MI-CONNECTION-STRING]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>720<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cookieless</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="uso-del-mismo-identificador-de-aplicacion-para-acceder-al-estado-de-la-sesion"><a href="#uso-del-mismo-identificador-de-aplicacion-para-acceder-al-estado-de-la-sesion" class="header-anchor">#</a> Uso del mismo identificador de aplicación para acceder al estado de la sesión</h2> <p>El punto final de la configuración nos lleva a reescribir el identificador que ASP.NET asigna a nuestras aplicaciones. El objetivo es hacer que ambas aplicaciones compartan el <em>AppId</em> que las identifica y de esa manera también compartirán el espacio del almacén de estado de la sesión.</p> <p>En primer lugar debemos crear una nueva entrada personalizada en el fichero <em>web.config</em> de ambas aplicaciones:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appSettings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>APPLICATION<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MiApp<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
&lt;/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appSettings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Y finalmente debemos agregar el siguente código al fichero <em>Global.asax</em> también de ambas aplicaciones:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PostAuthenticateRequest <span class="token operator">+=</span> MvcApplication_PostAuthenticateRequest<span class="token punctuation">;</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> appName <span class="token operator">=</span> ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;APPLICATION&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>appName<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> moduleName <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Modules<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">IHttpModule</span> module <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Modules<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">SessionStateModule</span> ssm <span class="token operator">=</span> module <span class="token keyword">as</span> <span class="token class-name">SessionStateModule</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ssm <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name">FieldInfo</span> storeInfo <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SessionStateModule</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">&quot;_store&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Instance <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">SessionStateStoreProviderBase</span> store <span class="token operator">=</span> <span class="token punctuation">(</span>SessionStateStoreProviderBase<span class="token punctuation">)</span>storeInfo<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>ssm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>store <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name">FieldInfo</span> runtimeInfo <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">HttpRuntime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">&quot;_theRuntime&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">HttpRuntime</span> theRuntime <span class="token operator">=</span> <span class="token punctuation">(</span>HttpRuntime<span class="token punctuation">)</span>runtimeInfo<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">FieldInfo</span> appNameInfo <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">HttpRuntime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">&quot;_appDomainAppId&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Instance <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        appNameInfo<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span>theRuntime<span class="token punctuation">,</span> appName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name">Type</span> storeType <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>storeType<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">&quot;OutOfProcSessionStateStore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token class-name">FieldInfo</span> uribaseInfo <span class="token operator">=</span> storeType<span class="token punctuation">.</span><span class="token function">GetField</span><span class="token punctuation">(</span><span class="token string">&quot;s_uribase&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Static <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            uribaseInfo<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span>storeType<span class="token punctuation">,</span> appName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Esta sería su misma versión en Visual Basic .NET:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">@</span> Application Language<span class="token operator">=</span><span class="token string">&quot;vb&quot;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">@</span> Import <span class="token keyword">Namespace</span><span class="token operator">=</span><span class="token string">&quot;System.Reflection&quot;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script runat<span class="token operator">=</span><span class="token string">&quot;server&quot;</span><span class="token operator">&gt;</span>
    <span class="token comment">'...</span>

    <span class="token keyword">Public</span> <span class="token keyword">Overrides</span> <span class="token keyword">Sub</span> Init<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">MyBase</span><span class="token punctuation">.</span>Init<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">Try</span>
            <span class="token keyword">Dim</span> appName <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">(</span><span class="token string">&quot;APPLICATION&quot;</span><span class="token punctuation">)</span>

            <span class="token keyword">If</span> <span class="token keyword">Not</span> <span class="token keyword">String</span><span class="token punctuation">.</span>IsNullOrEmpty<span class="token punctuation">(</span>appName<span class="token punctuation">)</span> <span class="token keyword">Then</span>

                <span class="token keyword">For</span> <span class="token keyword">Each</span> moduleName <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token keyword">In</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>Modules
                    <span class="token keyword">Dim</span> [<span class="token keyword">module</span>] <span class="token keyword">As</span> IHttpModule <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>Modules<span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span>
                    <span class="token keyword">Dim</span> ssm <span class="token keyword">As</span> SessionStateModule <span class="token operator">=</span> <span class="token keyword">TryCast</span><span class="token punctuation">(</span>[<span class="token keyword">module</span>]<span class="token punctuation">,</span> SessionStateModule<span class="token punctuation">)</span>

                    <span class="token keyword">If</span> ssm <span class="token keyword">IsNot</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
                        <span class="token keyword">Dim</span> storeInfo <span class="token keyword">As</span> FieldInfo <span class="token operator">=</span> <span class="token keyword">GetType</span><span class="token punctuation">(</span>SessionStateModule<span class="token punctuation">)</span><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">&quot;_store&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Instance <span class="token keyword">Or</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span>
                        <span class="token keyword">Dim</span> store <span class="token keyword">As</span> SessionStateStoreProviderBase <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>storeInfo<span class="token punctuation">.</span>GetValue<span class="token punctuation">(</span>ssm<span class="token punctuation">)</span><span class="token punctuation">,</span> SessionStateStoreProviderBase<span class="token punctuation">)</span>

                        <span class="token keyword">If</span> store <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
                            <span class="token keyword">Dim</span> runtimeInfo <span class="token keyword">As</span> FieldInfo <span class="token operator">=</span> <span class="token keyword">GetType</span><span class="token punctuation">(</span>HttpRuntime<span class="token punctuation">)</span><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">&quot;_theRuntime&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>[<span class="token keyword">Static</span>] <span class="token keyword">Or</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span>
                            <span class="token keyword">Dim</span> theRuntime <span class="token keyword">As</span> HttpRuntime <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>runtimeInfo<span class="token punctuation">.</span>GetValue<span class="token punctuation">(</span><span class="token boolean">Nothing</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HttpRuntime<span class="token punctuation">)</span>
                            <span class="token keyword">Dim</span> appNameInfo <span class="token keyword">As</span> FieldInfo <span class="token operator">=</span> <span class="token keyword">GetType</span><span class="token punctuation">(</span>HttpRuntime<span class="token punctuation">)</span><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">&quot;_appDomainAppId&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>Instance <span class="token keyword">Or</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span>
                            appNameInfo<span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span>theRuntime<span class="token punctuation">,</span> appName<span class="token punctuation">)</span>
                        <span class="token keyword">Else</span>
                            <span class="token keyword">Dim</span> storeType <span class="token keyword">As</span> <span class="token keyword">Type</span> <span class="token operator">=</span> store<span class="token punctuation">.</span>[<span class="token keyword">GetType</span>]<span class="token punctuation">(</span><span class="token punctuation">)</span>

                            <span class="token keyword">If</span> storeType<span class="token punctuation">.</span>Name<span class="token punctuation">.</span>Equals<span class="token punctuation">(</span><span class="token string">&quot;OutOfProcSessionStateStore&quot;</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                                <span class="token keyword">Dim</span> uribaseInfo <span class="token keyword">As</span> FieldInfo <span class="token operator">=</span> storeType<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">&quot;s_uribase&quot;</span><span class="token punctuation">,</span> BindingFlags<span class="token punctuation">.</span>[<span class="token keyword">Static</span>] <span class="token keyword">Or</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span>
                                uribaseInfo<span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span>storeType<span class="token punctuation">,</span> appName<span class="token punctuation">)</span>
                            <span class="token keyword">End</span> <span class="token keyword">If</span>
                        <span class="token keyword">End</span> <span class="token keyword">If</span>
                    <span class="token keyword">End</span> <span class="token keyword">If</span>
                <span class="token keyword">Next</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>

        <span class="token keyword">Catch</span> ex <span class="token keyword">As</span> Exception
            <span class="token keyword">Dim</span> s <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">Try</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>Puedes encontras más información y el código de referencia del último paso en la pregunta <em><a href="https://stackoverflow.com/questions/3438912/share-session-between-two-web-sites-using-asp-net-and-state-server" target="_blank" rel="noopener noreferrer">Share Session between two web sites using asp.net and state server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em> de StackOverflow.</p> <hr> <!----></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#creacion-de-cookies-a-nivel-de-dominio" title="Creación de cookies a nivel de dominio">Creación de cookies a nivel de dominio</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#configuracion-de-claves-de-cifrado" title="Configuración de claves de cifrado">Configuración de claves de cifrado</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#configuracion-de-la-autenticacion-y-del-estado-de-la-sesion" title="Configuración de la autenticación y del estado de la sesión">Configuración de la autenticación y del estado de la sesión</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#uso-del-mismo-identificador-de-aplicacion-para-acceder-al-estado-de-la-sesion" title="Uso del mismo identificador de aplicación para acceder al estado de la sesión">Uso del mismo identificador de aplicación para acceder al estado de la sesión</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="https://mobile.twitter.com/RNeto" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-fdbf4940><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-fdbf4940></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="/index.html" class="nav-link" data-v-fdbf4940>Rafael Neto © 2022</a></li></ul></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.141143c0.js" defer></script><script src="/assets/js/4.4029fd2e.js" defer></script><script src="/assets/js/1.86b5f33c.js" defer></script><script src="/assets/js/28.1ff7415b.js" defer></script>
  </body>
</html>
